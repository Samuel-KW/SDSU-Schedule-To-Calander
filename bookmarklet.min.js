javascript:(()=>{const t=Object.freeze({UNKNOWN:-1,ENROLLED:0,WAITLIST:1}),e=Intl.DateTimeFormat().resolvedOptions().timeZone,n=t=>t.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z";function s(t,e=new Date){const n=t.match(/^(\d{1,2}):(\d{2})(AM|PM)$/i);if(!n)throw new Error("Invalid time format. Must be formatted HH:mmAM/PM.");let[s,r,o,i]=n,l=parseInt(r,10);const a=parseInt(o,10);return"PM"===i.toUpperCase()&&12!==l?l+=12:"AM"===i.toUpperCase()&&12===l&&(l=0),e.setHours(l,a,0,0),e}class r{elemContainer;elemCourse;elemStartEnd;elemDays;elemTimes;elemRoom;elemStatus;constructor(t){this.elemContainer=t,this.elemCourse=t.querySelector("a[id^=DERIVED_SSR_FL_SSR_SCRTAB_DTLS]"),this.elemStartEnd=t.querySelector("span[id^=DERIVED_SSR_FL_SSR_ST_END_DT]"),this.elemDays=t.querySelector("span[id^=DERIVED_SSR_FL_SSR_DAYS]"),this.elemTimes=t.querySelector("span[id^=DERIVED_SSR_FL_SSR_DAYSTIMES]"),this.elemRoom=t.querySelector("span[id^=DERIVED_SSR_FL_SSR_DRV_ROOM]"),this.elemStatus=t.querySelector("span[id^=DERIVED_SSR_FL_SSR_DRV_STAT]")}get title(){return this.elemCourse.textContent.trim().replace(/\s{2,}/g," ")}get startEnd(){const[t,e]=this.elemStartEnd.textContent.split(" - ");return{start:new Date(t),end:new Date(e)}}get start(){return this.startEnd.start}get end(){return this.startEnd.end}get days(){const t=this.elemDays.textContent.trim().slice(6).toUpperCase();return"TO BE ANNOUNCED"===t?null:t.split(" ")}get times(){const t=this.elemTimes.textContent.trim().slice(7).toUpperCase();return"TO BE ANNOUNCED"===t?null:t.split(" TO ")}get room(){const t=this.elemRoom.textContent.replace(/\s/g,"").toUpperCase();return"ONLINE"===t?null:t}get status(){switch(this.elemStatus.textContent.replace(/\s/g,"").toUpperCase()){case"ENROLLED":return t.ENROLLED;case"WAITING":return t.WAITLIST;default:return-1}}toEvent(){return null===this.room?null:{summary:`${this.room} (${this.title})`,location:this.room,description:this.toString(),start:{dateTime:this.start.toISOString()},end:{dateTime:this.end.toISOString()},recurrence:["RRULE:FREQ=WEEKLY;BYDAY="+this.days.map((t=>t.slice(0,2))).join(",")],reminders:{useDefault:!1,overrides:[{method:"popup",minutes:15},{method:"popup",minutes:90}]}}}toICS(){const t=n(this.start),e=n(this.end),r=`FREQ=WEEKLY;BYDAY=${this.days.map((t=>t.slice(0,2))).join(",")};UNTIL=${e}Z`,o=this.times;return`BEGIN:VEVENT\nUID:${this.title.replace(/[^a-zA-Z0-9]/g,"")}@samuel-kw\nSUMMARY:${this.title}\nDESCRIPTION:${this.elemTimes.textContent.trim().slice(7)} on ${this.elemDays.textContent.trim().slice(6)}\nLOCATION:${this.room}\nDTSTART:${n(s(o[0],this.start))}\nDTEND:${n(s(o[1],this.start))}\nDTSTAMP:${t}\nRRULE:${r}\nCREATED:${n(new Date)}\nPRIORITY:0\nSTATUS:CONFIRMED\nEND:VEVENT\n`}toString(){return`${this.title} (${this.room})\n    Days: ${this.days?.join(", ")}\n    Times: ${this.times?.join(", ")}\n    Start: ${this.start}\n    End: ${this.end}\n    Status: ${Object.keys(t).find((e=>t[e]===this.status))}`}}let o=`BEGIN:VCALENDAR\nPRODID:-//Samuel KW//SDSU Class Exporter 0.0.1\nVERSION:2.0\nCALSCALE:GREGORIAN\nX-WR-CALNAME:SDSU School Schedule\nX-WR-TIMEZONE:${e}\nBEGIN:VTIMEZONE\nTZID:${e}\nX-LIC-LOCATION:${e}\nBEGIN:DAYLIGHT\nTZOFFSETFROM:-0800\nTZOFFSETTO:-0700\nTZNAME:PDT\nDTSTART:19700308T020000\nRRULE:FREQ=YEARLY;BYMONTH=3;BYDAY=2SU\nEND:DAYLIGHT\nBEGIN:STANDARD\nTZOFFSETFROM:-0700\nTZOFFSETTO:-0800\nTZNAME:PST\nDTSTART:19701101T020000\nRRULE:FREQ=YEARLY;BYMONTH=11;BYDAY=1SU\nEND:STANDARD\nEND:VTIMEZONE\n`;const i=document.querySelectorAll("div.ps_box-group > div.ps_box-scrollarea.psc_border-bottomonly > div.ps_box-scrollarea-row");for(const t of i){const e=new r(t);e.room?o+=e.toICS():console.log("Skipping online course:",e.toEvent())}(t=>{const e=new Blob([t],{type:"text/calendar"}),n=URL.createObjectURL(e),s=document.createElement("a");s.href=n,s.download="calendar",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(n)})(o+"END:VCALENDAR")})()